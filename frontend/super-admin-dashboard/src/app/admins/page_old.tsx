'use client';

import { useState } from 'react';
import { BasePage } from '@/components/ui/BasePage';
import { Button, Section, StatCard } from '@/components/ui/DarkThemeComponents';
import { useI18n } from '@/contexts/I18nContext';
import { withRBAC } from '@/components/auth/withRBAC';
import { UserManagement } from '@/components/auth/UserManagement';
import { User } from '@/types/auth';

function AdminsPage() {
  const { t } = useI18n();
  const [users, setUsers] = useState<User[]>([
    {
      id: '1',
      email: 'admin@dantaro.com',
      name: 'Super Admin',
      role: 'super_admin',
      isActive: true,
      lastLogin: new Date().toISOString(),
      createdAt: new Date().toISOString()
    },
    {
      id: '2',
      email: 'manager@dantaro.com',
      name: 'System Manager',
      role: 'admin',
      isActive: true,
      lastLogin: new Date(Date.now() - 86400000).toISOString(),
      createdAt: new Date().toISOString()
    },
    {
      id: '3',
      email: 'auditor@dantaro.com',
      name: 'Compliance Auditor',
      role: 'auditor',
      isActive: true,
      lastLogin: new Date(Date.now() - 172800000).toISOString(),
      createdAt: new Date().toISOString()
    },
    {
      id: '4',
      email: 'viewer@dantaro.com',
      name: 'Read Only User',
      role: 'viewer',
      isActive: false,
      createdAt: new Date().toISOString()
    }
  ]);

  const handleUpdateUser = (updatedUser: User) => {
    setUsers(users.map(user => 
      user.id === updatedUser.id ? updatedUser : user
    ));
  };

  const handleDeleteUser = (userId: string) => {
    setUsers(users.filter(user => user.id !== userId));
  };

  const activeUsersCount = users.filter(user => user.isActive).length;
  const totalUsersCount = users.length;
  const adminUsersCount = users.filter(user => user.role === 'admin' || user.role === 'super_admin').length;

  return (
    <BasePage title="Í¥ÄÎ¶¨Ïûê Í¥ÄÎ¶¨" description="ÏãúÏä§ÌÖú Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÏùÑ Í¥ÄÎ¶¨Ìï©ÎãàÎã§">
      {/* ÌÜµÍ≥Ñ Ïπ¥Îìú */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <StatCard
          title="Ï†ÑÏ≤¥ ÏÇ¨Ïö©Ïûê"
          value={totalUsersCount.toString()}
          icon="üë•"
          trend={{ value: 0, isPositive: true }}
        />
        <StatCard
          title="ÌôúÏÑ± ÏÇ¨Ïö©Ïûê"
          value={activeUsersCount.toString()}
          icon="‚úÖ"
          trend={{ value: 0, isPositive: true }}
        />
        <StatCard
          title="Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ï"
          value={adminUsersCount.toString()}
          icon="üîê"
          trend={{ value: 0, isPositive: true }}
        />
      </div>

      {/* ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ ÌÖåÏù¥Î∏î */}
      <UserManagement
        users={users}
        onUpdateUser={handleUpdateUser}
        onDeleteUser={handleDeleteUser}
      />
    </BasePage>
  );
}

  return (
    <BasePage 
      title={t.admins.title}
      description={t.admins.description}
      headerActions={headerActions}
    >
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
        <StatCard
          title={t.admins.superAdmins}
          value="3"
          icon="üëë"
          trend="neutral"
        />
        <StatCard
          title={t.admins.systemAdmins}
          value="8"
          icon="üîß"
          trend="up"
        />
        <StatCard
          title={t.admins.supportStaff}
          value="15"
          icon="üéß"
          trend="up"
        />
      </div>

      <Section title={t.admins.administratorList}>
        <div className="overflow-hidden shadow ring-1 ring-gray-700 rounded-lg">
          <table className="min-w-full divide-y divide-gray-600">
            <thead className="bg-gray-800">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                  {t.admins.administrator}
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                  {t.admins.role}
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                  {t.common.status}
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                  {t.admins.lastLogin}
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                  {t.common.actions}
                </th>
              </tr>
            </thead>
            <tbody className="bg-gray-900 divide-y divide-gray-700">
              <tr>
                <td className="px-6 py-4 whitespace-nowrap">
                  <div className="flex items-center">
                    <div className="h-10 w-10 bg-red-600 rounded-full flex items-center justify-center">
                      <span className="text-white font-medium">SA</span>
                    </div>
                    <div className="ml-4">
                      <div className="text-sm font-medium text-white">Super Admin</div>
                      <div className="text-sm text-gray-300">superadmin@dantaro.com</div>
                    </div>
                  </div>
                </td>
                <td className="px-6 py-4 whitespace-nowrap">
                  <span className="px-2 py-1 text-xs bg-red-900/30 text-red-300 rounded-full">
                    {t.admins.superAdmins}
                  </span>
                </td>
                <td className="px-6 py-4 whitespace-nowrap">
                  <span className="px-2 py-1 text-xs bg-green-900/30 text-green-300 rounded-full">
                    {t.admins.active}
                  </span>
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                  2ÏãúÍ∞Ñ Ï†Ñ
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                  <button 
                    className="text-blue-400 hover:text-blue-300 mr-3"
                    onClick={() => handleEditAdmin('Super Admin')}
                  >
                    {t.common.edit}
                  </button>
                  <button 
                    className="text-red-400 hover:text-red-300"
                    onClick={() => handleDisableAdmin('Super Admin')}
                  >
                    {t.admins.disable}
                  </button>
                </td>
              </tr>
              
              <tr>
                <td className="px-6 py-4 whitespace-nowrap">
                  <div className="flex items-center">
                    <div className="h-10 w-10 bg-blue-600 rounded-full flex items-center justify-center">
                      <span className="text-white font-medium">JD</span>
                    </div>
                    <div className="ml-4">
                      <div className="text-sm font-medium text-white">John Doe</div>
                      <div className="text-sm text-gray-300">john.doe@dantaro.com</div>
                    </div>
                  </div>
                </td>
                <td className="px-6 py-4 whitespace-nowrap">
                  <span className="px-2 py-1 text-xs bg-blue-900/30 text-blue-300 rounded-full">
                    {t.admins.systemAdmins}
                  </span>
                </td>
                <td className="px-6 py-4 whitespace-nowrap">
                  <span className="px-2 py-1 text-xs bg-green-900/30 text-green-300 rounded-full">
                    {t.admins.active}
                  </span>
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                  5ÏãúÍ∞Ñ Ï†Ñ
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                  <button 
                    className="text-blue-400 hover:text-blue-300 mr-3"
                    onClick={() => handleEditAdmin('John Doe')}
                  >
                    {t.common.edit}
                  </button>
                  <button 
                    className="text-red-400 hover:text-red-300"
                    onClick={() => handleDisableAdmin('John Doe')}
                  >
                    {t.admins.disable}
                  </button>
                </td>
              </tr>
              
              <tr>
                <td className="px-6 py-4 whitespace-nowrap">
                  <div className="flex items-center">
                    <div className="h-10 w-10 bg-green-600 rounded-full flex items-center justify-center">
                      <span className="text-white font-medium">JS</span>
                    </div>
                    <div className="ml-4">
                      <div className="text-sm font-medium text-white">Jane Smith</div>
                      <div className="text-sm text-gray-300">jane.smith@dantaro.com</div>
                    </div>
                  </div>
                </td>
                <td className="px-6 py-4 whitespace-nowrap">
                  <span className="px-2 py-1 text-xs bg-green-900/30 text-green-300 rounded-full">
                    {t.admins.supportStaff}
                  </span>
                </td>
                <td className="px-6 py-4 whitespace-nowrap">
                  <span className="px-2 py-1 text-xs bg-green-900/30 text-green-300 rounded-full">
                    {t.admins.active}
                  </span>
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                  1Ïùº Ï†Ñ
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                  <button 
                    className="text-blue-400 hover:text-blue-300 mr-3"
                    onClick={() => handleEditAdmin('Jane Smith')}
                  >
                    {t.common.edit}
                  </button>
                  <button 
                    className="text-red-400 hover:text-red-300"
                    onClick={() => handleDisableAdmin('Jane Smith')}
                  >
                    {t.admins.disable}
                  </button>
                </td>
              </tr>
              
              <tr>
                <td className="px-6 py-4 whitespace-nowrap">
                  <div className="flex items-center">
                    <div className="h-10 w-10 bg-gray-600 rounded-full flex items-center justify-center">
                      <span className="text-white font-medium">MB</span>
                    </div>
                    <div className="ml-4">
                      <div className="text-sm font-medium text-gray-400">Mike Brown</div>
                      <div className="text-sm text-gray-500">mike.brown@dantaro.com</div>
                    </div>
                  </div>
                </td>
                <td className="px-6 py-4 whitespace-nowrap">
                  <span className="px-2 py-1 text-xs bg-blue-900/30 text-blue-300 rounded-full">
                    {t.admins.systemAdmins}
                  </span>
                </td>
                <td className="px-6 py-4 whitespace-nowrap">
                  <span className="px-2 py-1 text-xs bg-gray-700 text-gray-400 rounded-full">
                    {t.admins.suspended}
                  </span>
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  3Ïùº Ï†Ñ
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                  <button 
                    className="text-green-400 hover:text-green-300 mr-3"
                    onClick={() => handleEnableAdmin('Mike Brown')}
                  >
                    {t.admins.enable}
                  </button>
                  <button 
                    className="text-blue-400 hover:text-blue-300"
                    onClick={() => handleEditAdmin('Mike Brown')}
                  >
                    {t.common.edit}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </Section>

      <div className="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Section title={t.admins.rolePermissions}>
          <div className="space-y-4">
            <div className="p-4 bg-gray-800 rounded-lg">
              <h4 className="text-sm font-medium text-white mb-2">{t.admins.superAdmins}</h4>
              <ul className="text-sm text-gray-300 space-y-1">
                <li>‚Ä¢ Ï†ÑÏ≤¥ ÏãúÏä§ÌÖú Í¥ÄÎ¶¨</li>
                <li>‚Ä¢ Î™®Îì† Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ï Í¥ÄÎ¶¨</li>
                <li>‚Ä¢ ÏãúÏä§ÌÖú ÏÑ§Ï†ï Î≥ÄÍ≤Ω</li>
                <li>‚Ä¢ Í∞êÏÇ¨ Î°úÍ∑∏ Ï†ëÍ∑º</li>
              </ul>
            </div>
            <div className="p-4 bg-gray-800 rounded-lg">
              <h4 className="text-sm font-medium text-white mb-2">{t.admins.systemAdmins}</h4>
              <ul className="text-sm text-gray-300 space-y-1">
                <li>‚Ä¢ ÌååÌä∏ÎÑà Í¥ÄÎ¶¨</li>
                <li>‚Ä¢ Í±∞Îûò Î™®ÎãàÌÑ∞ÎßÅ</li>
                <li>‚Ä¢ ÏóêÎÑàÏßÄ ÌíÄ Í¥ÄÎ¶¨</li>
                <li>‚Ä¢ ÏÇ¨Ïö©Ïûê ÏßÄÏõê</li>
              </ul>
            </div>
            <div className="p-4 bg-gray-800 rounded-lg">
              <h4 className="text-sm font-medium text-white mb-2">{t.admins.supportStaff}</h4>
              <ul className="text-sm text-gray-300 space-y-1">
                <li>‚Ä¢ ÏÇ¨Ïö©Ïûê Î¨∏Ïùò Ï≤òÎ¶¨</li>
                <li>‚Ä¢ Í∏∞Î≥∏ Í≥ÑÏ†ï Í¥ÄÎ¶¨</li>
                <li>‚Ä¢ Î≥¥Í≥†ÏÑú ÏÉùÏÑ±</li>
                <li>‚Ä¢ Ï†úÌïúÎêú ÏãúÏä§ÌÖú Ï†ëÍ∑º</li>
              </ul>
            </div>
          </div>
        </Section>

        <Section title={t.admins.recentActivity}>
          <div className="space-y-3">
            <div className="flex items-center p-3 bg-gray-800 rounded-lg">
              <div className="h-8 w-8 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                <span className="text-xs text-white">üë§</span>
              </div>
              <div className="flex-1">
                <p className="text-sm text-white">John DoeÍ∞Ä ÌååÌä∏ÎÑà ÏÑ§Ï†ïÏùÑ ÏàòÏ†ïÌñàÏäµÎãàÎã§</p>
                <p className="text-xs text-gray-400">30Î∂Ñ Ï†Ñ</p>
              </div>
            </div>
            <div className="flex items-center p-3 bg-gray-800 rounded-lg">
              <div className="h-8 w-8 bg-green-600 rounded-full flex items-center justify-center mr-3">
                <span className="text-xs text-white">‚úÖ</span>
              </div>
              <div className="flex-1">
                <p className="text-sm text-white">ÏÉà Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÏù¥ ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§</p>
                <p className="text-xs text-gray-400">2ÏãúÍ∞Ñ Ï†Ñ</p>
              </div>
            </div>
            <div className="flex items-center p-3 bg-gray-800 rounded-lg">
              <div className="h-8 w-8 bg-red-600 rounded-full flex items-center justify-center mr-3">
                <span className="text-xs text-white">üö´</span>
              </div>
              <div className="flex-1">
                <p className="text-sm text-white">Mike Brown Í≥ÑÏ†ïÏù¥ Ï†ïÏßÄÎêòÏóàÏäµÎãàÎã§</p>
                <p className="text-xs text-gray-400">3Ïùº Ï†Ñ</p>
              </div>
            </div>
          </div>
        </Section>
      </div>
    </BasePage>
  );
}

// Export protected component  
export default withRBAC(AdminsPage, { 
  requiredPermissions: ['users.view']
});